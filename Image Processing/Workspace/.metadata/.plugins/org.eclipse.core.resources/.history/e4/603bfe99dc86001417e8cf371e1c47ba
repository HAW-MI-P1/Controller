package common;

import java.io.BufferedInputStream;
import java.io.BufferedOutputStream;
import java.io.ByteArrayOutputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.URL;

public class WebPicture 
{
	private static final String TEMP_PATH = "temp.dat";
	
	private URL     url;
	private byte[]  picture;
	private boolean isDownloaded;
	
	public WebPicture(URL url)
	{
		this.url          = url;
		this.isDownloaded = false;
		this.picture      = null;
	}
	
	public URL getUrl()
	{
		return this.url;
	}
	
	public byte[] getPicture() throws IOException
	{
		if(!this.isDownloaded)
		{
			downloadImage();
		}
		
		return this.picture;
	}
	
	public boolean isDownloaded()
	{
		return this.isDownloaded;
	}
	
	public String pictureToFile() throws IOException
	{
		FileOutputStream fileStream = new FileOutputStream(this.TEMP_PATH);
		
		// byte array to file
		fileStream.write(this.getPicture());
		
		return TEMP_PATH;
	}
	
	private void downloadImage() throws IOException
	{
		InputStream           inputStream  = new BufferedInputStream(this.url.openStream());
		ByteArrayOutputStream byteStream = new ByteArrayOutputStream();

		for (int i = 0; (i = inputStream.read()) != -1;) 
		{
			byteStream.write(i);
		}
		
		inputStream.close();
		byteStream.close();
		
		// download ok!
		this.isDownloaded = true;
		this.picture = byteStream.toByteArray();
	}
}
